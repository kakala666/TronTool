---
type: implementation_plan
---

# TRON付款系统 - 项目重构实施计划

## 📋 总体目标

将 MyBlog 项目转变为 TRON USDT 付款系统，删除所有博客相关代码，保留并完善付款合约功能。

---

## 🗂️ 第一阶段：清理博客代码

### 步骤1: 删除Next.js博客相关文件
```
删除：
- /src/* (除了保留基础结构)
- /drizzle/*
- /openspec/*
- blog.db
- next.config.ts
- tsconfig.json
- package.json (需要重新创建)
- .next/*
```

### 步骤2: 保留并整理合约代码
```
保留：
- /tron-pool-test/contracts/Pool_v2.sol
- /tron-pool-test/手动测试指南.md
```

---

## 🏗️ 第二阶段：创建新项目结构

### 目标结构
```
d:/pythonProject/TronPaymentSystem/
├── contracts/
│   └── Pool.sol           # 生产版智能合约
├── web/
│   ├── index.html         # 员工操作页面
│   ├── admin.html         # 管理员页面
│   └── js/
│       ├── tronweb.js     # TronWeb库
│       └── app.js         # 业务逻辑
├── docs/
│   ├── 部署指南.md
│   ├── 员工操作手册.md
│   └── 管理员手册.md
└── README.md
```

---

## 💻 第三阶段：开发Web界面

### 3.1 员工操作页面 (index.html)

**功能清单：**
- [ ] 连接TronLink/imToken钱包
- [ ] 显示当前连接地址
- [ ] 显示资金池余额
- [ ] 输入收款地址
- [ ] 输入转账金额（USDT）
- [ ] 自动单位转换（1 USDT = 1,000,000 Sun）
- [ ] 执行转账
- [ ] 显示交易哈希和链接
- [ ] 转账历史记录

**技术要点：**
```javascript
// 使用TronWeb连接钱包
const tronWeb = window.tronLink.tronWeb;

// 调用合约payout方法
const contract = await tronWeb.contract().at(合约地址);
await contract.payout(收款地址, 金额).send();
```

### 3.2 管理员页面 (admin.html)

**功能清单：**
- [ ] 查看合约余额
- [ ] 查看所有授权员工列表
- [ ] 添加员工地址
- [ ] 移除员工地址
- [ ] 查看详细转账记录

---

## 📦 第四阶段：生产部署

### 4.1 主网部署清单

**准备工作：**
- [ ] 确保钱包有足够TRX（建议500+ TRX用于部署和资源）
- [ ] 准备初始充值USDT（建议100+ USDT）
- [ ] 收集所有员工的TRON地址

**部署步骤：**
1. [ ] 切换到TRON主网
2. [ ] 部署Pool.sol合约
   - USDT地址: `TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t`
3. [ ] 记录合约地址
4. [ ] 给合约充值USDT
5. [ ] 验证getBalance
6. [ ] 添加员工地址到白名单

### 4.2 Web部署

**部署方式选择：**

**方案A: 部署到公司服务器**
- 上传web文件夹到服务器
- 配置nginx/apache
- 设置HTTPS（重要！钱包需要安全连接）

**方案B: 使用GitHub Pages**
- 创建GitHub仓库
- 推送web文件
- 启用GitHub Pages
- 员工访问: `https://用户名.github.io/`

**方案C: IPFS去中心化托管**
- 上传到IPFS
- 获取访问链接
- 完全去中心化

---

## ✅ 第五阶段：测试验证

### 5.1 功能测试

**合约测试：**
- [ ] 充值测试（小额）
- [ ] 转账测试（小额）
- [ ] 授权测试（添加/移除员工）
- [ ] 余额查询测试

**Web测试：**
- [ ] 钱包连接测试
- [ ] 员工操作流程测试
- [ ] 管理员功能测试
- [ ] 移动端测试（imToken）
- [ ] 错误处理测试

### 5.2 安全检查

- [ ] 合约权限验证（只有授权地址能转账）
- [ ] 金额限制测试
- [ ] 异常情况处理
- [ ] 前端输入验证

---

## 📚 第六阶段：文档编写

### 6.1 部署指南
- 合约部署步骤
- Web部署方法
- 配置说明

### 6.2 员工操作手册
- 如何连接钱包
- 如何发起转账
- 常见问题FAQ

### 6.3 管理员手册
- 如何管理员工授权
- 如何充值资金池
- 如何查询记录

---

## 🎯 里程碑

### Milestone 1: 项目清理 ✅
**预计时间**: 30分钟  
**交付物**: 清理后的项目结构

### Milestone 2: Web界面开发 🔄
**预计时间**: 2小时  
**交付物**: 完整的Web界面

### Milestone 3: 主网部署 ⏳
**预计时间**: 1小时  
**交付物**: 运行在主网的合约和Web

### Milestone 4: 文档和培训 ⏳
**预计时间**: 1小时  
**交付物**: 完整操作文档

---

## ⚠️ 风险和注意事项

1. **资金安全**
   - 初次部署建议少量USDT测试
   - 确认功能正常后再充值大额

2. **权限管理**
   - 妥善保管owner钱包私钥
   - 定期审查授权员工列表

3. **网络费用**
   - 主网操作消耗TRX
   - 建议员工钱包保持50+ TRX余额

4. **浏览器兼容性**
   - 确保Web界面兼容主流钱包
   - 移动端测试必不可少

---

## 🚀 下一步行动

**立即执行：**
1. 确认删除博客代码
2. 创建新项目结构
3. 开发Web界面
4. 编写部署文档
