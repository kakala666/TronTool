# TRON 资金池合约 - 手动测试指南

## 📌 测试目标

验证：**B → 合约A → C**，链上显示付款方为合约地址A

---

## 准备工作

### 1️⃣ 需要准备的钱包

- **钱包B**（客户充值地址）：任意TRON钱包，有少量USDT用于测试
- **钱包C**（收款地址）：另一个TRON钱包，用于接收测试转账
- **部署钱包**（owner）：你的主钱包，需要有TRX用于部署合约（约200 TRX）

### 2️⃣ 安装工具

**TronLink钱包（Chrome插件）**
- 下载：https://www.tronlink.org/
- 导入你的部署钱包

**TronIDE（在线部署工具）**
- 网址：https://www.tronide.io/

---

## ✅ 第一步：部署合约

### 1. 打开 TronIDE

访问 https://www.tronide.io/

### 2. 创建新文件

- 点击左侧文件树的 `+` 号
- 文件名：`Pool.sol`
- 复制 `contracts/Pool.sol` 的代码粘贴进去

### 3. 编译合约

- 点击左侧 **Solidity Compiler** 图标
- 选择编译器版本：`0.8.6` 或更高
- 点击 **Compile Pool.sol**
- 等待编译成功（绿色勾）

### 4. 部署合约

**重要参数：TRON主网USDT合约地址**
```
TRC20-USDT: TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t
```

**部署步骤：**
1. 点击左侧 **Deploy & Run** 图标
2. Environment 选择 `Injected Provider - TronLink`
3. 连接你的TronLink钱包（确认授权）
4. Contract 下拉选择 `Pool`
5. 在 **Deploy** 旁边的输入框填入：
   ```
   "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t"
   ```
   ⚠️ 注意：地址要加英文双引号！
6. 点击 **Deploy** 按钮
7. TronLink弹窗确认交易（消耗约100-200 TRX）
8. 等待几秒，部署成功后会在下方显示合约实例

### 5. 记录合约地址

部署成功后，在 **Deployed Contracts** 区域会显示：
```
POOL AT 0xXXXXXXXX (TXXXXXXXXXX)
```

**这个 `TXXXXXXXXXX` 就是你的资金池合约地址A**

📝 **立即保存这个地址！**

---

## ✅ 第二步：往资金池充值（B → A）

### 1. 打开任意TRON钱包（imToken/TronLink等）

使用你的 **钱包B**

### 2. 发起USDT转账

- 选择 **USDT (TRC20)**
- 点击 **转账/发送**
- 收款地址填：**合约地址A**（上一步记录的）
- 金额：**10 USDT**（测试用）
- 确认发送

### 3. 验证充值成功

打开 TronScan 查询：
```
https://tronscan.org/#/contract/你的合约地址A
```

查看：
- **Tokens** 标签页 → 应该显示 **10 USDT** 余额
- **Transfers** 标签页 → 应该有一条 `B地址 → 合约A` 的转账记录

✅ **如果余额显示正确，说明资金池已建立！**

---

## ✅ 第三步：从资金池转账给C（A → C）

### 1. 回到 TronIDE

在 **Deployed Contracts** 区域找到你的 `POOL` 合约实例

### 2. 调用 payout 函数

展开 `POOL` 合约，找到 **payout** 方法：

**填写参数：**
- `to`（收款地址）：填入你的 **钱包C地址**
- `amount`（金额）：填入 `5000000`
  
  ⚠️ **注意单位换算：**
  - 1 USDT = 1,000,000 Sun
  - 转5 USDT = 5000000 Sun

**例如：**
```
to: TYour...WalletC...Address
amount: 5000000
```

### 3. 执行转账

1. 点击 **transact** 按钮
2. TronLink弹窗确认（消耗少量TRX作为能量）
3. 等待交易确认（几秒钟）

### 4. 验证转账成功

#### 方法一：查看钱包C余额
- 打开钱包C
- 查看USDT余额是否 **增加了5 USDT**

#### 方法二：查看TronScan链上记录

打开 TronScan 查询钱包C地址：
```
https://tronscan.org/#/address/钱包C地址
```

在 **Transfers** 标签页，找到最新的USDT转账记录：

**重点验证：**
```
From: 合约地址A  ✅ 
To: 钱包C地址    ✅
Amount: 5 USDT   ✅
```

✅ **如果 From 显示的是合约地址A，验证成功！**

---

## ✅ 第四步：完整验证

### 在 TronScan 上查看完整资金流

#### 1. 查询合约地址A的所有转账记录

```
https://tronscan.org/#/contract/合约地址A/transfers
```

**应该看到2条记录：**

| From | To | Amount | Type |
|------|-----|--------|------|
| 钱包B | 合约A | 10 USDT | In ⬇️ |
| 合约A | 钱包C | 5 USDT | Out ⬆️ |

#### 2. 从钱包C的视角验证

打开钱包C在TronScan的转账记录，确认：
- 付款方显示为：**合约地址A**（不是你的部署钱包地址）
- 金额正确

---

## 🎯 测试结论

如果以上所有验证通过，说明：

✅ **你的方案在链上是完全可行的**

关键验证点：
1. ✅ B可以向合约A充值USDT
2. ✅ 合约A持有USDT余额
3. ✅ 授权地址可以调用合约从A转账给C
4. ✅ **链上显示付款方为合约地址A（而非调用者）**

---

## 🔧 常见问题

### Q1: 部署时TronLink没反应？
- 检查Network是否选择了 **Mainnet**（主网）
- 确保钱包有足够的TRX（至少200）

### Q2: payout调用失败？
- 检查合约余额是否足够
- 检查amount单位是否正确（要乘以1,000,000）
- 确认调用的钱包是owner（部署钱包）

### Q3: 想测试授权员工？
在TronIDE的合约实例中：
1. 调用 `addStaff`，填入员工钱包地址
2. 切换TronLink到员工钱包
3. 再次调用 `payout`

### Q4: 想在测试网测试？
- USDT地址改为：`TXLAQ63Xg1NAzckPwKHvzw7CSEmLMEqcdj`（Nile测试网）
- TronLink切换到 **Nile Testnet**
- 从水龙头领取测试TRX和USDT

---

## 📊 测试数据记录表

测试完成后填写：

| 项目 | 地址/金额 | 状态 |
|------|----------|------|
| 合约地址A | `T...` | ⬜ |
| 钱包B地址 | `T...` | ⬜ |
| 钱包C地址 | `T...` | ⬜ |
| 充值金额 | ___ USDT | ⬜ |
| 转出金额 | ___ USDT | ⬜ |
| 链上From显示 | ⬜ 合约A / ⬜ 其他 | ⬜ |

---

## 下一步

测试通过后，可以考虑：
- 添加更多员工地址授权
- 设置每日转账限额
- 添加暂停开关
- 开发自动化操作界面

但这些都是在验证可行性之后的事。

**现在先完成手动测试！** 🚀
