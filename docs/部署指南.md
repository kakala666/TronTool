# 部署指南

## 一、测试网完整测试流程

### 步骤1：部署合约到测试网

1. **切换TronLink到测试网**
   - 打开TronLink钱包
   - 点击设置 → 切换网络 → **Nile Testnet**

2. **领取测试币**
   - 打开 https://nileex.io/join/getJoinPage
   - 输入你的钱包地址
   - 领取TRX和USDT（免费）

3. **部署合约**
   - 打开 https://www.tronide.io/
   - 连接TronLink（确保是Nile网络）
   - 新建文件 `Pool.sol`
   - 复制 `contracts/Pool.sol` 的代码
   - 编译（版本0.8.6+）
   - Deploy参数填：`"TXYZopYRdj2D9XRtbG411XZZ3kM5VkAeBf"`
   - 点击Deploy，确认交易
   - **记录合约地址**

4. **初始化合约**
   - 给合约转入10测试USDT
   - 在TronIDE点击 `getBalance` 验证余额

### 步骤2：配置Web

编辑 `web/js/config.js`：

```javascript
// 填入你的测试网合约地址
CONTRACT_ADDRESS_NILE: 'T你刚才部署的合约地址',

// 确保网络是测试网
NETWORK: 'nile',
```

### 步骤3：部署到GitHub Pages

1. **创建GitHub仓库**
   - 打开 https://github.com/new
   - 仓库名：`tron-payment`（或其他名称）
   - 公开仓库
   - 点击创建

2. **初始化Git并推送**

   打开PowerShell，在项目目录执行：

   ```powershell
   cd d:\pythonProject\MyBlog
   
   # 初始化Git
   git init
   
   # 添加所有文件
   git add .
   
   # 提交
   git commit -m "TRON Payment System"
   
   # 添加远程仓库（替换为你的仓库地址）
   git remote add origin https://github.com/你的用户名/tron-payment.git
   
   # 推送
   git branch -M main
   git push -u origin main
   ```

3. **启用GitHub Pages**
   - 打开仓库页面
   - 点击 **Settings**
   - 左侧菜单点击 **Pages**
   - Source选择：**Deploy from a branch**
   - Branch选择：**main** / **/web**（如果只想部署web文件夹）
   - 点击Save
   - 等待几分钟部署完成

4. **访问网站**
   
   部署成功后，访问：
   ```
   https://你的用户名.github.io/tron-payment/web/
   ```

### 步骤4：测试网功能验证

1. **员工页面测试**
   - 在imToken或TronLink中打开网页
   - 确保钱包在Nile测试网
   - 验证是否正确显示授权状态
   - 尝试转账功能

2. **管理员页面测试**
   - 用Owner钱包打开 `admin.html`
   - 测试添加/移除员工功能
   - 测试余额查询

---

## 二、正式上线（主网）

测试通过后，执行以下步骤：

### 步骤1：部署主网合约

1. 切换TronLink到 **Mainnet**
2. 确保有足够TRX（建议500+）
3. 在TronIDE部署，参数填：`"TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t"`
4. 记录主网合约地址
5. 给合约充值USDT

### 步骤2：更新配置

编辑 `web/js/config.js`：

```javascript
// 填入主网合约地址
CONTRACT_ADDRESS_MAINNET: 'T你的主网合约地址',

// 切换到主网
NETWORK: 'mainnet',
```

### 步骤3：重新部署

```powershell
git add .
git commit -m "Switch to mainnet"
git push
```

GitHub Pages会自动更新。

---

## 三、常见问题

### Q: GitHub Pages部署后打不开？
- 等待几分钟，首次部署需要时间
- 检查路径是否正确（/web/）
- 检查仓库是否公开

### Q: 测试网无法连接？
- 确认TronLink在Nile Testnet
- 确认配置文件 `NETWORK: 'nile'`

### Q: imToken无法打开？
- 确保使用HTTPS链接
- GitHub Pages自带HTTPS

### Q: 转账失败？
- 检查TRX余额是否充足
- 检查合约余额是否充足
- 检查是否已授权

---

## 四、快速命令参考

```powershell
# 推送更新
git add .
git commit -m "更新说明"
git push

# 查看状态
git status

# 拉取更新
git pull
```
