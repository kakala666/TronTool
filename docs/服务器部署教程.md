# 服务器部署完整教程

## 服务器环境
- IP: 124.156.138.98
- 系统: Debian

---

## 第一步：登录服务器

```bash
ssh root@124.156.138.98
```

---

## 第二步：安装Node.js

```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt-get install -y nodejs
```

验证：
```bash
node -v
npm -v
```

---

## 第三步：安装Ngrok

```bash
# 下载并安装
wget https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz
tar -xvzf ngrok-v3-stable-linux-amd64.tgz
mv ngrok /usr/local/bin/

# 验证
ngrok version

# 配置AuthToken
ngrok config add-authtoken 2JrKASvMXikuBF0s7BlTOJOAcJB_2c6nMy1KkJosDpGdXXGLn
```

---

## 第四步：拉取代码

```bash
cd /opt
git clone https://github.com/kakala666/TronTool.git tron-payment
cd /opt/tron-payment/server
npm install
```

---

## 第五步：配置环境变量

```bash
cat > /opt/tron-payment/server/.env << 'EOF'
TRON_FULL_HOST=https://nile.trongrid.io
POOL_CONTRACT_ADDRESS=TLbaAcdsxcgqu4g4qHW9m3Tz6YLQmcHdCy
USDT_CONTRACT_ADDRESS=TXYZopYRdj2D9XRtbG411XZZ3kM5VkAeBf
OWNER_PRIVATE_KEY=6a16b49e461d3878527c3f06122efafd061f47fc691cc1c26d5afe45f9e13842
ENCRYPTION_KEY=Tr0nP@yEncrypt2026SecureK3y!
PORT=4000
API_SECRET=TronPay2026SecureKey!@#$
EOF
```

---

## 第六步：启动服务（使用screen后台运行）

```bash
# 安装screen
apt-get install -y screen

# 启动Ngrok（后台）
screen -S ngrok
ngrok http --domain=cleta-unviolent-braelyn.ngrok-free.app 4000
# 按 Ctrl+A 然后 D 脱离

# 启动后端（后台）
screen -S backend
cd /opt/tron-payment/server
node index.js
# 按 Ctrl+A 然后 D 脱离
```

---

## 第七步：验证

访问: https://cleta-unviolent-braelyn.ngrok-free.app/health

应返回: `{"status":"ok"}`

---

## 常用命令

```bash
# 查看Ngrok日志
screen -r ngrok

# 查看后端日志
screen -r backend

# 退出screen: Ctrl+A 然后 D
```
